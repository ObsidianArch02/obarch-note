## WSL2 与宿主机网络互通设置

> 参考
> [wsl2-ubuntu 通过 win10 代理连接互联网 - 知乎](https://zhuanlan.zhihu.com/p/382939467)
> [记录一次 WSL2 的网络代理配置 | jiayaoO3O's Blog](https://jiayaoo3o.github.io/2020/06/23/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1WSL2%E7%9A%84%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE/)

默认情况下，Windows 的防火墙会阻止 WSL2 子系统向宿主机的通信，需要在“高级安全 Windows Defender 防火墙”中设置入站规则。

运行`ip route`查看 WSL2 与宿主机的 IP 信息，以及需要配置的子网信息。

另外：

在 Win10 -> WSL2 这个方向, 是可以直接通过 Localhost 来访问的, 但是 WSL2 -> Win10 这个方向就不能直接访问 Localhost 了, 需要指定 Win10 的 ip, 想要查看 WSL2 中 Win10 的 ip, 只需要查看`resolve.conf` :

```sh
cat /etc/resolv.conf

# This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
# [network]
# generateResolvConf = false
nameserver 172.18.176.1
```

这个 172.18.176.1 就是在 WSL2 中 Win10 的 ip.

想要方便获取这个 IP, 可以直接使用下方命令 :

```sh
cat /etc/resolv.conf|grep nameserver|awk '{print $2}'
```

如要使用部署在宿主机上的代理服务，需要打开 Windows 针对代理服务的防火墙设置。

并修改`~/.bashrc`文件：

```sh
host_ip=$(cat /etc/resolv.conf |grep "nameserver" |cut -f 2 -d " ")
export ALL_PROXY="socks5://$host_ip:7890"
export all_proxy="socks5://$host_ip:7890"
export https_proxy="socks5://$host_ip:7890"
export http_proxy="http://$host_ip:7890"
```

然后重载：

```sh
source ~/.bashrc
```

或者使用脚本：

```sh
#!/bin/sh
hostip=$(cat /etc/resolv.conf | grep nameserver | awk '{ print $2 }')
#wslip=$(hostname -I | awk '{print $1}')
port=<PORT>

PROXY_HTTP="http://${hostip}:${port}"

set_proxy(){
    export http_proxy="${PROXY_HTTP}"
    export HTTP_PROXY="${PROXY_HTTP}"

    export https_proxy="${PROXY_HTTP}"
    export HTTPS_proxy="${PROXY_HTTP}"
}

unset_proxy(){
    unset http_proxy
    unset HTTP_PROXY
    unset https_proxy
    unset HTTPS_PROXY
}

test_setting(){
    echo "Host ip:" ${hostip}
    #echo "WSL ip:" ${wslip}
    echo "Current proxy:" $https_proxy
}

if [ "$1" = "set" ]
then
    set_proxy

elif [ "$1" = "unset" ]
then
    unset_proxy

elif [ "$1" = "test" ]
then
    test_setting
else
    echo "Unsupported arguments."
fi
```

另外可以在`~/.bashrc`中选择性的加上下面两句话，记得**将里面的路径修改成你放这个脚本的路径**。

```sh
alias proxy="source /path/to/proxy.sh"
. /path/to/proxy.sh set
```

第一句话可以为这个脚本设置别名`proxy`，这样在任何路径下都可以通过`proxy`命令使用这个脚本了，之后在任何路径下，都可以随时都可以通过输入`proxy unset`来暂时取消代理。第二句话就是在每次 shell 启动的时候运行该脚本实现自动设置代理，这样以后不用额外操作就默认设置好代理啦~

参见：[WSL2 中访问宿主机 Windows 的代理 - ZingLix Blog](https://zinglix.xyz/2020/04/18/wsl2-proxy/)

## 部署 openwrt

### 在 virtualbox 虚拟机中的配置实例 & 基础配置

- [Win10 VirtualBox 安装 OpenWrt/LEDE - 码农教程](http://www.manongjc.com/detail/23-bkgkvtnoahqjrrc.html)
- [[OpenWrt Wiki] 在 Virtualbox 虚拟机中运行 OpenWrt](https://openwrt.org/zh/docs/guide-user/virtualization/virtualbox-vm)
- [VirtualBox 虚拟机网络搭建 NAT、桥接、Host-Only、Internal 等(centos7) - 简书](https://www.jianshu.com/p/0537b056790b)
- [lede/openwrt 环境的 自带源 和 国内源 相关配置 - Allen Hua 的网络博客](https://hellodk.cn/post/246)
- [OpenWrt 固件配置图文教程，安装中文语言包，路由器设置网络 wifi - 哔哩哔哩](https://www.bilibili.com/read/cv6727285/)

### 定制固件

- [[2022-09-05] x86/R2S/R4S/R5S/R2C/R68S 一分钟在线定制固件 官方纯净 云插件 OTA-软路由,x86 系统,openwrt(x86),Router OS 等-恩山无线论坛](https://www.right.com.cn/forum/thread-8023604-1-1.html)
- [OpenWrt 固件下载与在线定制编译](https://supes.top/?version=22.03&target=x86%2F64&id=generic)
- [miaoermua/CatWrt: 🌠 更稳定，更好玩的 OpenWrt 发行版！](https://github.com/miaoermua/CatWrt)

### 插件

openclash adghome(DoH)

- [OpenClash 使用教程 | 酱紫表](https://qust.me/post/openClash/)
- [LEDE(OpenWrt)安装 openclash ｜旁路由技巧 ｜ 配置网络流量全部通过旁路由 - 腾讯云开发者社区-腾讯云](https://cloud.tencent.com/developer/article/1693260)
- [用这些 OpenWRT 插件来武装你的路由器 - 知乎](https://zhuanlan.zhihu.com/p/103121214)

## 家庭流媒体服务器

[[230118]Jellyfin 中国特供版+Docker 镜像，含驱动，免折腾开箱即用 - 电脑讨论(新) - Chiphell - 分享与交流用户体验](https://www.chiphell.com/thread-2375777-1-1.html)

天雪 PT 定制 Jellyfin 搜刮策略

## Git 服务器

### GitHub 添加 ssh 密钥 & 操作系统密钥生成

```sh
ssh-keygen
```

参见：[如何解决 git@github.com permission denied (publickey). fatal could not read from remote repository - 知乎](https://zhuanlan.zhihu.com/p/454666519)

多 Git 环境可能的解决方案：

参见：[Git 提示 Permission denied (publickey)，如何才能解决？ - 知乎 电脑有多个 git 环境](https://zhuanlan.zhihu.com/p/281094708)

## Linux系统性能优化

内核魔改
[XanMod Kernel](https://xanmod.org/)

Arch Linux下的makepkg的性能优化，待补充

[Linux 下使用 Lutris 安装并游玩低延迟音频 osu!Stable 相关指北 | 砂糖砂糖沙](https://blacksand.top/2021/10/02/Linux%E4%B8%8B%E4%BD%BF%E7%94%A8Lutris%E5%AE%89%E8%A3%85%E5%B9%B6%E6%B8%B8%E7%8E%A9%E4%BD%8E%E5%BB%B6%E8%BF%9F%E9%9F%B3%E9%A2%91osu!%20%E7%9B%B8%E5%85%B3%E6%8C%87%E5%8C%97/#%E6%9B%B4%E6%8D%A2Lutris%E7%9A%84Wine%E6%9E%84%E5%BB%BA%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89)